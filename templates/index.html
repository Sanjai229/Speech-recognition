<!DOCTYPE html>
<html>
<head>
    <title>Speech & Gender Recognition</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<h1>Speech Recognition & Gender Detection</h1>

<button id="record">üé§ Record</button>
<button id="stop" disabled>‚èπ Stop</button>

<p><b>Transcription:</b> <span id="text">-</span></p>
<p><b>Gender:</b> <span id="gender">-</span></p>

<script>
let recorder, audioChunks = [];

document.getElementById("record").onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);
    audioChunks = [];

    recorder.ondataavailable = e => audioChunks.push(e.data);
    recorder.start();

    document.getElementById("record").disabled = true;
    document.getElementById("stop").disabled = false;
};

document.getElementById("stop").onclick = async () => {
    recorder.stop();

    recorder.onstop = async () => {
        const blob = new Blob(audioChunks, { type: "audio/webm" });
        const formData = new FormData();
        formData.append("audio", blob);

        const res = await fetch("/transcribe", {
            method: "POST",
            body: formData
        });

        const data = await res.json();
        document.getElementById("text").innerText = data.transcription;
        document.getElementById("gender").innerText = data.gender;
    };

    document.getElementById("record").disabled = false;
    document.getElementById("stop").disabled = true;
};
</script>
</body>
</html>
