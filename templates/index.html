<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Speech Recognition + Gender Detection</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h1>ðŸŽ¤ Speech Recognition & Gender Detection</h1>

<button id="recordBtn">Start Recording</button>
<button id="stopBtn" disabled>Stop Recording</button>

<p id="status"></p>

<h3>Transcription:</h3>
<p id="text"></p>

<h3>Gender:</h3>
<p id="gender"></p>

<script>
let mediaRecorder;
let audioChunks = [];

const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");

recordBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

  mediaRecorder = new MediaRecorder(stream, {
    mimeType: "audio/webm;codecs=opus"
  });

  audioChunks = [];

  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) audioChunks.push(e.data);
  };

  mediaRecorder.start();
  recordBtn.disabled = true;
  stopBtn.disabled = false;
  document.getElementById("status").innerText = "Recording...";
};

stopBtn.onclick = async () => {
  mediaRecorder.stop();

  mediaRecorder.onstop = async () => {
    document.getElementById("status").innerText = "Transcribing...";

    const audioBlob = new Blob(audioChunks, { type: "audio/webm" });

    const formData = new FormData();
    formData.append("audio", audioBlob, "recording.webm");

    const response = await fetch("/transcribe", {
      method: "POST",
      body: formData
    });

    const result = await response.json();

    document.getElementById("text").innerText = result.text;
    document.getElementById("gender").innerText = result.gender;

    recordBtn.disabled = false;
    stopBtn.disabled = true;
    document.getElementById("status").innerText = "";
  };
};
</script>

</body>
</html>
