<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Speech to Text + Gender Detection</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>ðŸŽ™ Speech to Text & Gender Detection</h1>

    <div class="controls">
        <button id="startBtn">Start Recording</button>
        <button id="stopBtn" disabled>Stop Recording</button>
    </div>

    <div class="output">
        <p><strong>Transcription:</strong></p>
        <p id="transcription">--</p>

        <p><strong>Gender:</strong>
            <span id="gender">--</span>
        </p>
    </div>
</div>

<script>
let recorder;
let audioChunks = [];

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const transcription = document.getElementById("transcription");
const gender = document.getElementById("gender");

startBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);
    audioChunks = [];

    recorder.ondataavailable = e => audioChunks.push(e.data);

    recorder.onstop = async () => {
        const blob = new Blob(audioChunks, { type: "audio/wav" });
        const formData = new FormData();
        formData.append("audio", blob, "recording.wav");

        transcription.innerText = "Transcribing...";
        gender.innerText = "--";

        try {
            const res = await fetch("/transcribe", {
                method: "POST",
                body: formData
            });

            const data = await res.json();
            transcription.innerText = data.text;
            gender.innerText = data.gender;

        } catch {
            transcription.innerText = "Error in transcription";
            gender.innerText = "Undefined";
        }
    };

    recorder.start();
    startBtn.disabled = true;
    stopBtn.disabled = false;
};

stopBtn.onclick = () => {
    recorder.stop();
    startBtn.disabled = false;
    stopBtn.disabled = true;
};
</script>

</body>
</html>
