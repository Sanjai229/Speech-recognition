<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Speech Recognition</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>Speech Recognition</h1>

    <button id="recordBtn">üé§ Start Recording</button>
    <button id="stopBtn" disabled>‚èπ Stop</button>

    <h3>Transcription:</h3>
    <p id="text">‚Äî</p>

    <h3>Gender:</h3>
    <p id="gender">‚Äî</p>
  </div>

<script>
let mediaRecorder;
let audioChunks = [];

const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");

recordBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.start();

  recordBtn.disabled = true;
  stopBtn.disabled = false;
};

stopBtn.onclick = async () => {
  mediaRecorder.stop();

  mediaRecorder.onstop = async () => {
    const blob = new Blob(audioChunks, { type: "audio/webm" });
    const formData = new FormData();
    formData.append("audio", blob, "recording.webm");

    const res = await fetch("/transcribe", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    document.getElementById("text").innerText = data.text;
    document.getElementById("gender").innerText = data.gender;
  };

  recordBtn.disabled = false;
  stopBtn.disabled = true;
};
</script>
</body>
</html>
