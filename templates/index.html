<!DOCTYPE html>
<html>
<head>
    <title>Speech to Text + Gender Detection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Speak and Predict</h1>
    <button id="recordBtn">Start Recording</button>
    <p id="resultText"></p>
    <p id="resultGender"></p>

    <script>
        const recordBtn = document.getElementById("recordBtn");
        const resultText = document.getElementById("resultText");
        const resultGender = document.getElementById("resultGender");

        recordBtn.addEventListener("click", async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const mediaRecorder = new MediaRecorder(stream);
            let audioChunks = [];

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = async () => {
                const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                const formData = new FormData();
                formData.append("audio", audioBlob, "speech.wav");

                const response = await fetch("/predict", {
                    method: "POST",
                    body: formData
                });

                const data = await response.json();
                resultText.innerText = "Text: " + data.text;
                resultGender.innerText = "Gender: " + data.gender;
            };

            mediaRecorder.start();
            recordBtn.innerText = "Recording...";
            setTimeout(() => {
                mediaRecorder.stop();
                recordBtn.innerText = "Start Recording";
            }, 5000); // record 5 seconds
        });
    </script>
</body>
</html>
